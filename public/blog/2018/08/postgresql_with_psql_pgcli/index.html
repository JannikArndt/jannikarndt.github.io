<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Examining a PostgreSQL with psql or pgcli | Jannik Arndt</title>

<meta name="keywords" content="DevOps" />
<meta name="description" content="The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion.">
<meta name="author" content="Jannik">
<link rel="canonical" href="https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/" />
<link href="/assets/css/stylesheet.min.642e2a0657439d758aca2aedf3ef6ad1415d2d970562c281dd262c6aad4686b1.css" integrity="sha256-ZC4qBldDnXWKyirt8&#43;9q0UFdLZcFYsKB3SYsaq1GhrE=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="https://www.jannikarndt.de/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.jannikarndt.de/favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.jannikarndt.de/favicons/favicon-16x16.png">
<link rel="apple-touch-icon" href="https://www.jannikarndt.de/favicons/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.jannikarndt.de/favicons/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.82.0" />


<meta property="og:title" content="Examining a PostgreSQL with psql or pgcli" />
<meta property="og:description" content="The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/" /><meta property="og:image" content="https://www.jannikarndt.de/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2018-08-16T15:00:00&#43;01:00" />
<meta property="article:modified_time" content="2018-08-16T15:00:00&#43;01:00" /><meta property="og:site_name" content="Jannik Arndt" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.jannikarndt.de/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"/>

<meta name="twitter:title" content="Examining a PostgreSQL with psql or pgcli"/>
<meta name="twitter:description" content="The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Blogs",
      "item": "https://www.jannikarndt.de/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Examining a PostgreSQL with psql or pgcli",
      "item": "https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Examining a PostgreSQL with psql or pgcli",
  "name": "Examining a PostgreSQL with psql or pgcli",
  "description": "The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion.\n",
  "keywords": [
    "DevOps"
  ],
  "articleBody": "The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion.\nStarting and Connecting psql comes with you local PostgreSQL installation, pgcli can be installed via brew install pgcli or pip install pgcli.\nWhen you start the tool, you need to specify the connection. PostgreSQL can be accessed via TCP/IP or Unix Sockets. If you installed Postgres.app, TCP will be the standard and you only need to specify the host (h):\n$ psql -h localhost This assumes three things:\n the user is your OS user the database name is the same as the user connections from localhost are automatically trusted the port is 5432  Let’s go into details here:\nThe User To be precise, PostgreSQL doesn’t have users, it has roles. Roles you can login with are created as ROLE WITH LOGIN. A standard installation usually comes with a role for the OS account and a postgres role. To add more roles, you need to login first.\n Tip: Users can be listed with the \\du+ command!\n The Database The OS user and the postgres role have a corresponding database, which is automatically selected. However, if you create a new role and try to log in as that role, you will likely receive the error\n$ psql -h localhost -p 5432 -U foo FATAL: database \"foo\" does not exist Thus you’ll have to specify the database you want to connect to as well:\n$ psql -h localhost -p 5432 -U foo -d postgres By the way: During a session you can always change the database you’re connected to with \\c , but you cannot be connected to no database at any moment.\nThe Password In a fresh installation, your OS user and the postgres role do not have a password set. This would usually mean that you cannot use that role to login with, but the standard Client Authentication Configuration, i.e. the pg_hba.conf file is configured to trust all connections from localhost or 127.0.0.1/32.\nActually assigning a password to a role won’t change anything, only if you change the line in the pg_hba.conf too will you be asked to provide a password when logging in:\n# TYPE DATABASE USER ADDRESS METHOD # IPv4 local connections: host all all 127.0.0.1/32 md5 # IPv6 local connections: host all all ::1/128 md5  Tip: Starting with PostgreSQL 10, you can also use scram-sha-256 for password hashing.\n Since you don’t want to pass the password as a command line parameter, since it is then leaked into the history-file, you can add an entry to a .pgpass file in your $HOME:\n# hostname:port:database:username:password localhost:5432:*:postgres:mySuperSecretPassword Now everytime you connect to a PostgreSQL instance on localhost port 5432 and any database using the postgres role, the password is filled in automatically.\nThe Port Since you can run multiple PostgreSQL instances on the same machine but all are reached via localhost, you need to provide different ports for every instance. If oyu only have one instance, the standard port is 5432.\nSumming up So in essence, the command\n$ psql -h localhost does the same as\n$ psql -h localhost -p 5432 -U  -d  Password for user postgres: ... Looking around While you can execute any SQL statement you want using the psql tool, there are a few shortcuts that make your life easier (if you can remember them). To list them all, write \\? or have a look at this cheat sheet:\nDatabases  Tip: If you don’t have a database to play with, try out this example dump!\n I like to start listing all databases in the current instance, using\njannikarndt@[local]:jannikarndt=# \\l+ List of databases ┌─────────────┬─────────────┬─────┬─────────┬────────────┬──────────────┐ │ Name │ Owner │ ... │ Size │ Tablespace │ Description │ ├─────────────┼─────────────┼─────┼─────────┼────────────┼──────────────┤ │ jannikarndt │ jannikarndt │ ... │ 7709 kB │ pg_default │ ... │ │ mywebshop │ jannikarndt │ ... │ 14 MB │ pg_default │ ... │ │ postgres │ postgres │ ... │ 8005 kB │ pg_default │ ... │ │ template0 │ postgres │ ... │ 7577 kB │ pg_default │ ... │ │ template1 │ postgres │ ... │ 7577 kB │ pg_default │ ... │ └─────────────┴─────────────┴─────┴─────────┴────────────┴──────────────┘ (5 rows) (slightly abbreviated by the columns Encoding, Collate, Ctype, Access privileges and Tablespace)As you see, one of the databases is larger then the others. That might be an interesting one.\nTo list tables in that database, we first have to connect to it:\njannikarndt@[local]:jannikarndt=# \\dn+ List of schemas ┌────────┬──────────┬──────────────────────┬────────────────────────┐ │ Name │ Owner │ Access privileges │ Description │ ├────────┼──────────┼──────────────────────┼────────────────────────┤ │ public │ postgres │ postgres=UC/postgres↵│ standard public schema │ │ │ │ =UC/postgres │ │ └────────┴──────────┴──────────────────────┴────────────────────────┘ (1 row) jannikarndt@[local]:jannikarndt=# \\c mywebshop You are now connected to database \"mywebshop\" as user \"jannikarndt\". jannikarndt@[local]:mywebshop=# \\dn+ List of schemas ┌─────────┬──────────┬──────────────────────┬────────────────────────┐ │ Name │ Owner │ Access privileges │ Description │ ├─────────┼──────────┼──────────────────────┼────────────────────────┤ │ public │ postgres │ postgres=UC/postgres↵│ standard public schema │ │ │ │ =UC/postgres │ │ │ webshop │ postgres │ │ │ └─────────┴──────────┴──────────────────────┴────────────────────────┘ (2 rows) Note that the first and the second entry for public are different schemas! The first is jannikarndt.public, the second is mywebshop.public.\nTables Next, let’s list all tables in the webshop schema. Running \\dt+ unfortunately will either result in\njannikarndt@[local]:mywebshop=# \\dt+ Did not find any relations. or showing tables that have nothing to do with the webshop schema:\njannikarndt@[local]:mywebshop=# \\dt+ List of relations ┌────────┬──────────────┬───────┬──────────┬─────────┬─────────────┐ │ Schema │ Name │ Type │ Owner │ Size │ Description │ ├────────┼──────────────┼───────┼──────────┼─────────┼─────────────┤ │ public │ public_table │ table │ postgres │ 0 bytes │ │ └────────┴──────────────┴───────┴──────────┴─────────┴─────────────┘ (1 row) This is because if you don’t enter a search path, psql will use your current search path, which points to the schema with your username and the public schema:\njannikarndt@[local]:mywebshop=# SHOW search_path mywebshop-# ; ┌─────────────────┐ │ search_path │ ├─────────────────┤ │ \"$user\", public │ └─────────────────┘ (1 row) To list the tables of the webshop schema, you have to either set the search path using SET search_path TO webshop; or make it explicit in the query:\njannikarndt@[local]:mywebshop=# \\dt+ webshop.* List of relations ┌─────────┬─────────────────┬───────┬──────────┬─────────┬────────────────────┐ │ Schema │ Name │ Type │ Owner │ Size │ Description │ ├─────────┼─────────────────┼───────┼──────────┼─────────┼────────────────────┤ │ webshop │ address │ table │ postgres │ 136 kB │ Addresses for r... │ │ webshop │ articles │ table │ postgres │ 2872 kB │ Instance of a p... │ │ webshop │ colors │ table │ postgres │ 48 kB │ Colors with nam... │ │ webshop │ customer │ table │ postgres │ 152 kB │ Basic customer ... │ │ webshop │ labels │ table │ postgres │ 112 kB │ Brands / labels... │ │ webshop │ order │ table │ postgres │ 176 kB │ Metadata for an... │ │ webshop │ order_positions │ table │ postgres │ 384 kB │ Articles that a... │ │ webshop │ products │ table │ postgres │ 112 kB │ Groups articles... │ │ webshop │ sizes │ table │ postgres │ 16 kB │ Colors with nam... │ │ webshop │ stock │ table │ postgres │ 928 kB │ Amount of artic... │ └─────────┴─────────────────┴───────┴──────────┴─────────┴────────────────────┘ (10 rows) Setting the search path allows you to query multiple schemas:\njannikarndt@[local]:mywebshop=# SET search_path TO webshop,public; SET jannikarndt@[local]:mywebshop=# \\dt List of relations ┌─────────┬─────────────────┬───────┬──────────┐ │ Schema │ Name │ Type │ Owner │ ├─────────┼─────────────────┼───────┼──────────┤ │ public │ public_table │ table │ postgres │ │ webshop │ address │ table │ postgres │ │ ... │ ... │ ... │ ... │ └─────────┴─────────────────┴───────┴──────────┘ (11 rows) To query all schemas, run \\dt+ *.*, but beware, this also lists the tables in information_schema and pg_catalog, so… a lot.\nViews Attention: \\dt only lists tables, not views. Those need to be queried seperately:\njannikarndt@[local]:mywebshop=# \\dv+ webshop.* List of relations ┌─────────┬──────────────────────────┬──────┬──────────┬─────────┬─────────────┐ │ Schema │ Name │ Type │ Owner │ Size │ Description │ ├─────────┼──────────────────────────┼──────┼──────────┼─────────┼─────────────┤ │ webshop │ most_ordered_products │ view │ postgres │ 0 bytes │ │ │ webshop │ numbers_sold_per_article │ view │ postgres │ 0 bytes │ │ │ webshop │ numbers_sold_per_product │ view │ postgres │ 0 bytes │ │ └─────────┴──────────────────────────┴──────┴──────────┴─────────┴─────────────┘ (3 rows) Detailed Information Next, you can get all information on a single table with \\d+ .:\njannikarndt@[local]:mywebshop=# \\d webshop.order Table \"webshop.order\" ┌───────────────────┬────────────────┬──────┬──────────┬─────────────────┐ │ Column │ Type │ Coll │ Nullable │ Default │ ├───────────────────┼────────────────┼──────┼──────────┼─────────────────┤ │ id │ integer │ │ not null │ nextval(ord... │ │ customerid │ integer │ │ │ │ │ ordertimestamp │ timestamp w... │ │ │ now() │ │ shippingaddressid │ integer │ │ │ │ │ total │ money │ │ │ │ │ shippingcost │ money │ │ │ │ │ created │ timestamp w... │ │ │ now() │ │ updated │ timestamp w... │ │ │ │ └───────────────────┴────────────────┴──────┴──────────┴─────────────────┘ Indexes: \"order_pkey\" PRIMARY KEY, btree (id) Foreign-key constraints: \"fk_order_to_customer\" FOREIGN KEY (customerid) REFERENCES customer(id) \"order_shippingaddressid_fkey\" FOREIGN KEY (shippingaddressid) REFERENCES address(id) Referenced by: TABLE \"order_positions\" CONSTRAINT \"order_positions_orderid_fkey\" FOREIGN KEY (orderid) REFERENCES \"order\"(id) Or for views:\njannikarndt@[local]:mywebshop=# \\d+ webshop.most_ordered_products View \"webshop.most_ordered_products\" ┌──────────────────────┬─────────┬───────────┬──────────┬─────────┬──────────┬──────┐ │ Column │ Type │ Collation │ Nullable │ Default │ Storage │ Desc │ ├──────────────────────┼─────────┼───────────┼──────────┼─────────┼──────────┼──────┤ │ id │ integer │ │ │ │ plain │ │ │ label │ text │ │ │ │ extended │ │ │ product │ text │ │ │ │ extended │ │ │ number_products_sold │ numeric │ │ │ │ main │ │ └──────────────────────┴─────────┴───────────┴──────────┴─────────┴──────────┴──────┘ View definition: SELECT products.id, labels.name AS label, products.name AS product, numbers_sold_per_product.number_products_sold FROM products products JOIN labels ON products.labelid = labels.id JOIN numbers_sold_per_product ON products.id = numbers_sold_per_product.productid ORDER BY numbers_sold_per_product.number_products_sold DESC LIMIT 20; Note that appending the + gives you the CREATE-statement for the view.\nUsers / Roles Finally, we should also have a look at the users:\njannikarndt@[local]:jannikarndt=# \\du+ List of roles ┌──────────────┬────────────────────────────────────┬────────────────┬─────────────┐ │ Role name │ Attributes │ Member of │ Description │ ├──────────────┼────────────────────────────────────┼────────────────┼─────────────┤ │ analytics │ │ {readonly} │ │ │ jannikarndt │ Superuser, Create role, Create DB │ {} │ │ │ mobile_app │ │ {write_access} │ │ │ postgres │ Superuser, Create role, Create DB, │ │ │ │ │ Replication, Bypass RLS │ │ │ │ readonly │ Cannot login │ {} │ │ │ web_app │ │ {write_access} │ │ │ write_access │ Cannot login │ {} │ │ └──────────────┴────────────────────────────────────┴────────────────┴─────────────┘ Officially, PostgreSQL doesn’t have users, only roles. The command however still uses the u.\nYou can see here, that there are two roles that cannot login (readonly and write_access). These are typically used to defined permissions. The roles that can login (analytics, web_app and mobile_app) are member of one of these roles so the admin doesn’t have to care about setting permissions for each of them.\nRecap To sum it up, these are the most important commands:\n\\l+ -- list databases \\c -- connect to a database \\dn+ -- list schemas \\dt+ schema.* -- list tables \\dv+ schema.* -- list views \\d+ schema.relname -- describe table or view \\du+ -- list users / roles ",
  "wordCount" : "1810",
  "inLanguage": "en",
  "datePublished": "2018-08-16T15:00:00+01:00",
  "dateModified": "2018-08-16T15:00:00+01:00",
  "author":{
    "@type": "Person",
    "name": "Jannik"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jannik Arndt",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.jannikarndt.de/favicon.ico"
    }
  }
}
</script>





</head>

<body class="" id="top">
<script>
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: #1d1e20;
                --entry: #2e2e33;
                --primary: rgba(255, 255, 255, 0.84);
                --secondary: rgba(255, 255, 255, 0.56);
                --tertiary: rgba(255, 255, 255, 0.16);
                --content: rgba(255, 255, 255, 0.74);
                --hljs-bg: #2e2e33;
                --code-bg: #37383e;
                --border: #333;
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }
    </style>

</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.jannikarndt.de" accesskey="h" title="JannikArndt.de (Alt + H)">
                <img src="/favicons/apple-touch-icon.png" alt="logo" aria-label="logo"
                    height="35">JannikArndt.de</a>
            <span class="logo-switches">
                
                
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="https://www.jannikarndt.de/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://www.jannikarndt.de/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://www.jannikarndt.de/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://example.org" title="example.org">
                    <span>example.org</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">
<div class="breadcrumbs">

    <a href="https://www.jannikarndt.de">Home</a>&nbsp;»&nbsp;<a href="https://www.jannikarndt.de/blog/">Blogs</a>
</div>

    <h1 class="post-title">
      Examining a PostgreSQL with psql or pgcli
    </h1>
    <div class="post-meta">

August 16, 2018&nbsp;·&nbsp;Jannik


</div>
  </header> 

  <div class="post-content">
<p>The PostgreSQL installation comes with a great tool, <code>psql</code>, to administer and inspect the database. <a href="https://www.pgcli.com"><code>pgcli</code></a> extends this with syntax highlighting and autocompletion.</p>
<h2 id="starting-and-connecting">Starting and Connecting<a hidden class="anchor" aria-hidden="true" href="#starting-and-connecting">#</a></h2>
<p><code>psql</code> comes with you local PostgreSQL installation, <code>pgcli</code> can be installed via <code>brew install pgcli</code> or <code>pip install pgcli</code>.</p>
<p>When you start the tool, you need to specify the connection. PostgreSQL can be accessed via <em>TCP/IP</em> or <em>Unix Sockets</em>. If you installed <a href="https://postgresapp.com/">Postgres.app</a>, TCP will be the standard and you only need to specify the host (<code>h</code>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ psql -h localhost
</code></pre></div><p>This assumes three things:</p>
<ul>
<li>the user is your OS user</li>
<li>the database name is the same as the user</li>
<li>connections from localhost are automatically trusted</li>
<li>the port is 5432</li>
</ul>
<p>Let&rsquo;s go into details here:</p>
<h3 id="the-user">The User<a hidden class="anchor" aria-hidden="true" href="#the-user">#</a></h3>
<p>To be precise, PostgreSQL doesn&rsquo;t have users, it has roles. Roles you can login with are created as <code>ROLE WITH LOGIN</code>. A standard installation usually comes with a role for the OS account and a <code>postgres</code> role. To add more roles, you need to login first.</p>
<blockquote>
<p>Tip: Users can be listed with the <code>\du+</code> command!</p>
</blockquote>
<h3 id="the-database">The Database<a hidden class="anchor" aria-hidden="true" href="#the-database">#</a></h3>
<p>The OS user and the postgres role have a corresponding database, which is automatically selected. However, if you create a new role and try to log in as that role, you will likely receive the error</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ psql -h localhost -p <span style="color:#ae81ff">5432</span> -U foo
FATAL:  database <span style="color:#e6db74">&#34;foo&#34;</span> does not exist
</code></pre></div><p>Thus you&rsquo;ll have to specify the database you want to connect to as well:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ psql -h localhost -p <span style="color:#ae81ff">5432</span> -U foo -d postgres
</code></pre></div><p>By the way: During a session you can always change the database you&rsquo;re connected to with <code>\c &lt;databasename&gt;</code>, but you cannot be connected to no database at any moment.</p>
<h3 id="the-password">The Password<a hidden class="anchor" aria-hidden="true" href="#the-password">#</a></h3>
<p>In a fresh installation, your OS user and the postgres role do not have a password set. This would usually mean that you cannot use that role to login with, <em>but</em> the standard <em>Client Authentication Configuration</em>, i.e. the <code>pg_hba.conf</code> file is configured to <code>trust</code> all connections from <code>localhost</code> or <code>127.0.0.1/32</code>.</p>
<p>Actually assigning a password to a role won&rsquo;t change anything, only if you change the line in the <code>pg_hba.conf</code> too will you be asked to provide a password when logging in:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>
<span style="color:#75715e"># IPv4 local connections:</span>
<span style="color:#a6e22e">host    all             all             127.0.0.1/32            md5</span>
<span style="color:#75715e"># IPv6 local connections:</span>
<span style="color:#a6e22e">host    all             all             ::1/128                 md5</span>
</code></pre></div><blockquote>
<p>Tip: Starting with PostgreSQL 10, you can also use <code>scram-sha-256</code> for password hashing.</p>
</blockquote>
<p>Since you don&rsquo;t want to pass the password as a command line parameter, since it is then leaked into the history-file, you can add an entry to a <code>.pgpass</code> file in your $HOME:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#75715e"># hostname:port:database:username:password</span>
<span style="color:#a6e22e">localhost:5432:*:postgres:mySuperSecretPassword</span>
</code></pre></div><p>Now everytime you connect to a PostgreSQL instance on <code>localhost</code> port <code>5432</code> and <em>any</em> database using the <code>postgres</code> role, the password is filled in automatically.</p>
<h3 id="the-port">The Port<a hidden class="anchor" aria-hidden="true" href="#the-port">#</a></h3>
<p>Since you can run multiple PostgreSQL instances on the same machine but all are reached via <code>localhost</code>, you need to provide different ports for every instance. If oyu only have one instance, the standard port is <code>5432</code>.</p>
<h3 id="summing-up">Summing up<a hidden class="anchor" aria-hidden="true" href="#summing-up">#</a></h3>
<p>So in essence, the command</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ psql -h localhost
</code></pre></div><p>does the same as</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ psql -h localhost -p <span style="color:#ae81ff">5432</span> -U &lt;os-user&gt; -d &lt;os-user&gt;
Password <span style="color:#66d9ef">for</span> user postgres: ...
</code></pre></div><h2 id="looking-around">Looking around<a hidden class="anchor" aria-hidden="true" href="#looking-around">#</a></h2>
<p>While you can execute any SQL statement you want using the <code>psql</code> tool, there are a few shortcuts that make your life easier (if you can remember them). To list them all, write <code>\?</code> or have a look at <a href="http://gpdb.docs.pivotal.io/gs/43/pdf/PSQLQuickRef.pdf">this cheat sheet</a>:</p>
<h3 id="databases">Databases<a hidden class="anchor" aria-hidden="true" href="#databases">#</a></h3>
<blockquote>
<p>Tip: If you don&rsquo;t have a database to play with, try out <a href="https://github.com/JannikArndt/PostgreSQLSampleDatabase">this example dump</a>!</p>
</blockquote>
<p>I like to start listing all databases in the current instance, using</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:jannikarndt<span style="color:#f92672">=</span><span style="color:#75715e"># \l+</span>

                          List of databases
┌─────────────┬─────────────┬─────┬─────────┬────────────┬──────────────┐
│    Name     │    Owner    │ ... │  Size   │ Tablespace │ Description  │
├─────────────┼─────────────┼─────┼─────────┼────────────┼──────────────┤
│ jannikarndt │ jannikarndt │ ... │ <span style="color:#ae81ff">7709</span> kB │ pg_default │ ...          │
│ mywebshop   │ jannikarndt │ ... │ <span style="color:#ae81ff">14</span> MB   │ pg_default │ ...          │
│ postgres    │ postgres    │ ... │ <span style="color:#ae81ff">8005</span> kB │ pg_default │ ...          │
│ template0   │ postgres    │ ... │ <span style="color:#ae81ff">7577</span> kB │ pg_default │ ...          │
│ template1   │ postgres    │ ... │ <span style="color:#ae81ff">7577</span> kB │ pg_default │ ...          │
└─────────────┴─────────────┴─────┴─────────┴────────────┴──────────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">5</span> rows<span style="color:#f92672">)</span>
</code></pre></div><p><!-- raw HTML omitted -->(slightly abbreviated by the columns <code>Encoding</code>, <code>Collate</code>, <code>Ctype</code>, <code>Access privileges</code> and <code>Tablespace</code>)<!-- raw HTML omitted --></p>
<p>As you see, one of the databases is larger then the others. That might be an interesting one.</p>
<p>To list tables in that database, we first have to connect to it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:jannikarndt<span style="color:#f92672">=</span><span style="color:#75715e"># \dn+</span>

                           List of schemas
┌────────┬──────────┬──────────────────────┬────────────────────────┐
│  Name  │  Owner   │  Access privileges   │      Description       │
├────────┼──────────┼──────────────────────┼────────────────────────┤
│ public │ postgres │ postgres<span style="color:#f92672">=</span>UC/postgres↵│ standard public schema │
│        │          │ <span style="color:#f92672">=</span>UC/postgres         │                        │
└────────┴──────────┴──────────────────────┴────────────────────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> row<span style="color:#f92672">)</span>

jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:jannikarndt<span style="color:#f92672">=</span><span style="color:#75715e"># \c mywebshop</span>
You are now connected to database <span style="color:#e6db74">&#34;mywebshop&#34;</span> as user <span style="color:#e6db74">&#34;jannikarndt&#34;</span>.

jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \dn+</span>

                           List of schemas
┌─────────┬──────────┬──────────────────────┬────────────────────────┐
│  Name   │  Owner   │  Access privileges   │      Description       │
├─────────┼──────────┼──────────────────────┼────────────────────────┤
│ public  │ postgres │ postgres<span style="color:#f92672">=</span>UC/postgres↵│ standard public schema │
│         │          │ <span style="color:#f92672">=</span>UC/postgres         │                        │
│ webshop │ postgres │                      │                        │
└─────────┴──────────┴──────────────────────┴────────────────────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> rows<span style="color:#f92672">)</span>
</code></pre></div><p>Note that the first and the second entry for <code>public</code> are <em>different</em> schemas! The first is <code>jannikarndt.public</code>, the second is <code>mywebshop.public</code>.</p>
<h3 id="tables">Tables<a hidden class="anchor" aria-hidden="true" href="#tables">#</a></h3>
<p>Next, let&rsquo;s <strong>list all tables</strong> in the <code>webshop</code> schema. Running <code>\dt+</code> unfortunately will either result in</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \dt+</span>
Did not find any relations.
</code></pre></div><p>or showing tables that have nothing to do with the <code>webshop</code> schema:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \dt+</span>

                         List of relations
┌────────┬──────────────┬───────┬──────────┬─────────┬─────────────┐
│ Schema │     Name     │ Type  │  Owner   │  Size   │ Description │
├────────┼──────────────┼───────┼──────────┼─────────┼─────────────┤
│ public │ public_table │ table │ postgres │ <span style="color:#ae81ff">0</span> bytes │             │
└────────┴──────────────┴───────┴──────────┴─────────┴─────────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> row<span style="color:#f92672">)</span>
</code></pre></div><p>This is because if you don&rsquo;t enter a <em>search path</em>, <code>psql</code> will use your <em>current</em> search path, which points to the schema with your username and the public schema:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># SHOW search_path</span>
mywebshop-# ;
┌─────────────────┐
│   search_path   │
├─────────────────┤
│ <span style="color:#e6db74">&#34;</span>$user<span style="color:#e6db74">&#34;</span>, public │
└─────────────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> row<span style="color:#f92672">)</span>
</code></pre></div><p>To list the tables of the <code>webshop</code> schema, you have to either <strong>set the search path</strong> using <code>SET search_path TO webshop;</code> or <strong>make it explicit in the query</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \dt+ webshop.*</span>

                         List of relations
┌─────────┬─────────────────┬───────┬──────────┬─────────┬────────────────────┐
│ Schema  │      Name       │ Type  │  Owner   │  Size   │    Description     │
├─────────┼─────────────────┼───────┼──────────┼─────────┼────────────────────┤
│ webshop │ address         │ table │ postgres │ <span style="color:#ae81ff">136</span> kB  │ Addresses <span style="color:#66d9ef">for</span> r... │
│ webshop │ articles        │ table │ postgres │ <span style="color:#ae81ff">2872</span> kB │ Instance of a p... │
│ webshop │ colors          │ table │ postgres │ <span style="color:#ae81ff">48</span> kB   │ Colors with nam... │
│ webshop │ customer        │ table │ postgres │ <span style="color:#ae81ff">152</span> kB  │ Basic customer ... │
│ webshop │ labels          │ table │ postgres │ <span style="color:#ae81ff">112</span> kB  │ Brands / labels... │
│ webshop │ order           │ table │ postgres │ <span style="color:#ae81ff">176</span> kB  │ Metadata <span style="color:#66d9ef">for</span> an... │
│ webshop │ order_positions │ table │ postgres │ <span style="color:#ae81ff">384</span> kB  │ Articles that a... │
│ webshop │ products        │ table │ postgres │ <span style="color:#ae81ff">112</span> kB  │ Groups articles... │
│ webshop │ sizes           │ table │ postgres │ <span style="color:#ae81ff">16</span> kB   │ Colors with nam... │
│ webshop │ stock           │ table │ postgres │ <span style="color:#ae81ff">928</span> kB  │ Amount of artic... │
└─────────┴─────────────────┴───────┴──────────┴─────────┴────────────────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">10</span> rows<span style="color:#f92672">)</span>
</code></pre></div><p>Setting the search path allows you to <strong>query multiple schemas</strong>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># SET search_path TO webshop,public;</span>
SET
jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \dt</span>

               List of relations
┌─────────┬─────────────────┬───────┬──────────┐
│ Schema  │      Name       │ Type  │  Owner   │
├─────────┼─────────────────┼───────┼──────────┤
│ public  │ public_table    │ table │ postgres │
│ webshop │ address         │ table │ postgres │
│ ...     │ ...             │ ...   │ ...      │
└─────────┴─────────────────┴───────┴──────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">11</span> rows<span style="color:#f92672">)</span>
</code></pre></div><p>To query <em>all</em> schemas, run <code>\dt+ *.*</code>, but beware, this also lists the tables in <code>information_schema</code> and <code>pg_catalog</code>, so… a lot.</p>
<h3 id="views">Views<a hidden class="anchor" aria-hidden="true" href="#views">#</a></h3>
<p>Attention: <code>\dt</code> only lists <em>tables</em>, not views. Those need to be queried seperately:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \dv+ webshop.*</span>

                               List of relations
┌─────────┬──────────────────────────┬──────┬──────────┬─────────┬─────────────┐
│ Schema  │           Name           │ Type │  Owner   │  Size   │ Description │
├─────────┼──────────────────────────┼──────┼──────────┼─────────┼─────────────┤
│ webshop │ most_ordered_products    │ view │ postgres │ <span style="color:#ae81ff">0</span> bytes │             │
│ webshop │ numbers_sold_per_article │ view │ postgres │ <span style="color:#ae81ff">0</span> bytes │             │
│ webshop │ numbers_sold_per_product │ view │ postgres │ <span style="color:#ae81ff">0</span> bytes │             │
└─────────┴──────────────────────────┴──────┴──────────┴─────────┴─────────────┘
<span style="color:#f92672">(</span><span style="color:#ae81ff">3</span> rows<span style="color:#f92672">)</span>
</code></pre></div><h3 id="detailed-information">Detailed Information<a hidden class="anchor" aria-hidden="true" href="#detailed-information">#</a></h3>
<p>Next, you can get all information on a single table with <code>\d+ &lt;schema&gt;.&lt;tablename&gt;</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \d webshop.order</span>

                        Table <span style="color:#e6db74">&#34;webshop.order&#34;</span>
┌───────────────────┬────────────────┬──────┬──────────┬─────────────────┐
│      Column       │     Type       │ Coll │ Nullable │    Default      │
├───────────────────┼────────────────┼──────┼──────────┼─────────────────┤
│ id                │ integer        │      │ not null │ nextval<span style="color:#f92672">(</span>ord...  │
│ customerid        │ integer        │      │          │                 │
│ ordertimestamp    │ timestamp w... │      │          │ now<span style="color:#f92672">()</span>           │
│ shippingaddressid │ integer        │      │          │                 │
│ total             │ money          │      │          │                 │
│ shippingcost      │ money          │      │          │                 │
│ created           │ timestamp w... │      │          │ now<span style="color:#f92672">()</span>           │
│ updated           │ timestamp w... │      │          │                 │
└───────────────────┴────────────────┴──────┴──────────┴─────────────────┘
Indexes:
    <span style="color:#e6db74">&#34;order_pkey&#34;</span> PRIMARY KEY, btree <span style="color:#f92672">(</span>id<span style="color:#f92672">)</span>
Foreign-key constraints:
    <span style="color:#e6db74">&#34;fk_order_to_customer&#34;</span> FOREIGN KEY <span style="color:#f92672">(</span>customerid<span style="color:#f92672">)</span> REFERENCES customer<span style="color:#f92672">(</span>id<span style="color:#f92672">)</span>
    <span style="color:#e6db74">&#34;order_shippingaddressid_fkey&#34;</span> FOREIGN KEY <span style="color:#f92672">(</span>shippingaddressid<span style="color:#f92672">)</span> REFERENCES address<span style="color:#f92672">(</span>id<span style="color:#f92672">)</span>
Referenced by:
    TABLE <span style="color:#e6db74">&#34;order_positions&#34;</span> CONSTRAINT <span style="color:#e6db74">&#34;order_positions_orderid_fkey&#34;</span> 
    FOREIGN KEY <span style="color:#f92672">(</span>orderid<span style="color:#f92672">)</span> REFERENCES <span style="color:#e6db74">&#34;order&#34;</span><span style="color:#f92672">(</span>id<span style="color:#f92672">)</span>
</code></pre></div><p>Or for views:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:mywebshop<span style="color:#f92672">=</span><span style="color:#75715e"># \d+ webshop.most_ordered_products</span>

                          View <span style="color:#e6db74">&#34;webshop.most_ordered_products&#34;</span>
┌──────────────────────┬─────────┬───────────┬──────────┬─────────┬──────────┬──────┐
│        Column        │  Type   │ Collation │ Nullable │ Default │ Storage  │ Desc │
├──────────────────────┼─────────┼───────────┼──────────┼─────────┼──────────┼──────┤
│ id                   │ integer │           │          │         │ plain    │      │
│ label                │ text    │           │          │         │ extended │      │
│ product              │ text    │           │          │         │ extended │      │
│ number_products_sold │ numeric │           │          │         │ main     │      │
└──────────────────────┴─────────┴───────────┴──────────┴─────────┴──────────┴──────┘
View definition:
 SELECT products.id,
    labels.name AS label,
    products.name AS product,
    numbers_sold_per_product.number_products_sold
   FROM products products
     JOIN labels ON products.labelid <span style="color:#f92672">=</span> labels.id
     JOIN numbers_sold_per_product ON products.id <span style="color:#f92672">=</span> numbers_sold_per_product.productid
  ORDER BY numbers_sold_per_product.number_products_sold DESC
 LIMIT 20;
</code></pre></div><p>Note that appending the <code>+</code> gives you the <code>CREATE</code>-statement for the view.</p>
<h3 id="users--roles">Users / Roles<a hidden class="anchor" aria-hidden="true" href="#users--roles">#</a></h3>
<p>Finally, we should also have a look at the users:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">jannikarndt@<span style="color:#f92672">[</span>local<span style="color:#f92672">]</span>:jannikarndt<span style="color:#f92672">=</span><span style="color:#75715e"># \du+</span>

                                List of roles
┌──────────────┬────────────────────────────────────┬────────────────┬─────────────┐
│  Role name   │       Attributes                   │   Member of    │ Description │
├──────────────┼────────────────────────────────────┼────────────────┼─────────────┤
│ analytics    │                                    │ <span style="color:#f92672">{</span>readonly<span style="color:#f92672">}</span>     │             │
│ jannikarndt  │ Superuser, Create role, Create DB  │ <span style="color:#f92672">{}</span>             │             │
│ mobile_app   │                                    │ <span style="color:#f92672">{</span>write_access<span style="color:#f92672">}</span> │             │
│ postgres     │ Superuser, Create role, Create DB, │                │             │
│              │ Replication, Bypass RLS            │                │             │
│ readonly     │ Cannot login                       │ <span style="color:#f92672">{}</span>             │             │
│ web_app      │                                    │ <span style="color:#f92672">{</span>write_access<span style="color:#f92672">}</span> │             │
│ write_access │ Cannot login                       │ <span style="color:#f92672">{}</span>             │             │
└──────────────┴────────────────────────────────────┴────────────────┴─────────────┘
</code></pre></div><p>Officially, PostgreSQL doesn&rsquo;t have users, only roles. The command however still uses the <code>u</code>.</p>
<p>You can see here, that there are two roles that cannot login (<code>readonly</code> and <code>write_access</code>). These are typically used to defined permissions. The roles that <em>can</em> login (<code>analytics</code>, <code>web_app</code> and <code>mobile_app</code>) are member of one of these roles so the admin doesn&rsquo;t have to care about setting permissions for each of them.</p>
<h3 id="recap">Recap<a hidden class="anchor" aria-hidden="true" href="#recap">#</a></h3>
<p>To sum it up, these are the most important commands:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">\</span>l<span style="color:#f92672">+</span>                     <span style="color:#75715e">-- list databases
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">c</span>                      <span style="color:#75715e">-- connect to a database
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">\</span>dn<span style="color:#f92672">+</span>                    <span style="color:#75715e">-- list schemas
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">\</span>dt<span style="color:#f92672">+</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">schema</span><span style="color:#f92672">&gt;</span>.<span style="color:#f92672">*</span>         <span style="color:#75715e">-- list tables
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">\</span>dv<span style="color:#f92672">+</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">schema</span><span style="color:#f92672">&gt;</span>.<span style="color:#f92672">*</span>         <span style="color:#75715e">-- list views
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">\</span>d<span style="color:#f92672">+</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">schema</span><span style="color:#f92672">&gt;</span>.<span style="color:#f92672">&lt;</span>relname<span style="color:#f92672">&gt;</span>  <span style="color:#75715e">-- describe table or view
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">\</span>du<span style="color:#f92672">+</span>                    <span style="color:#75715e">-- list users / roles
</span></code></pre></div>
</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.jannikarndt.de/tags/postgresql/">PostgreSQL</a></li>
    </ul>
  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2021 <a href="https://www.jannikarndt.de">Jannik Arndt</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>



<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>

</body>

</html>
