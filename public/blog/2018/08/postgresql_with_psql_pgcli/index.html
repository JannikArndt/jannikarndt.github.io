<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Examining a PostgreSQL with psql or pgcli | Jannik Arndt</title>
<meta name="keywords" content="DevOps, PostgreSQL, Database, Postgres, pgsql, psql, pgcli" />
<meta name="description" content="The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion.">
<meta name="author" content="Jannik Arndt">
<link rel="canonical" href="https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.6ba7c53c3f51641b823df58d9ff4f7fcc09ea1d26e863a9b6fddbe45b3fa71a9.css" integrity="sha256-a6fFPD9RZBuCPfWNn/T3/MCeodJuhjqbb92&#43;RbP6cak=" rel="preload stylesheet" as="style">
<link rel="preload" href="/favicons/apple-touch-icon.png" as="image">
<link rel="icon" href="https://www.jannikarndt.de/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://www.jannikarndt.de/favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://www.jannikarndt.de/favicons/favicon-16x16.png">
<link rel="apple-touch-icon" href="https://www.jannikarndt.de/favicons/apple-touch-icon.png">
<link rel="mask-icon" href="https://www.jannikarndt.de/favicons/apple-touch-icon.png">
<meta name="theme-color" content="#576175">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.89.2" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Examining a PostgreSQL with psql or pgcli" />
<meta property="og:description" content="The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/" /><meta property="og:image" content="https://www.jannikarndt.de/jannik.jpg"/><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2018-08-16T15:00:00&#43;01:00" />
<meta property="article:modified_time" content="2018-08-16T15:00:00&#43;01:00" /><meta property="og:site_name" content="Jannik Arndt" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.jannikarndt.de/jannik.jpg"/>

<meta name="twitter:title" content="Examining a PostgreSQL with psql or pgcli"/>
<meta name="twitter:description" content="The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blog",
      "item": "https://www.jannikarndt.de/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Examining a PostgreSQL with psql or pgcli",
      "item": "https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Examining a PostgreSQL with psql or pgcli",
  "name": "Examining a PostgreSQL with psql or pgcli",
  "description": "The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion.\n",
  "keywords": [
    "DevOps", "PostgreSQL", "Database", "Postgres", "pgsql", "psql", "pgcli"
  ],
  "articleBody": "The PostgreSQL installation comes with a great tool, psql, to administer and inspect the database. pgcli extends this with syntax highlighting and autocompletion.\nStarting and Connecting psql comes with you local PostgreSQL installation, pgcli can be installed via brew install pgcli or pip install pgcli.\nWhen you start the tool, you need to specify the connection. PostgreSQL can be accessed via TCP/IP or Unix Sockets. If you installed Postgres.app, TCP will be the standard and you only need to specify the host (h):\n$ psql -h localhost This assumes three things:\n the user is your OS user the database name is the same as the user connections from localhost are automatically trusted the port is 5432  Let’s go into details here:\nThe User To be precise, PostgreSQL doesn’t have users, it has roles. Roles you can login with are created as ROLE WITH LOGIN. A standard installation usually comes with a role for the OS account and a postgres role. To add more roles, you need to login first.\n Tip: Users can be listed with the \\du+ command!\n The Database The OS user and the postgres role have a corresponding database, which is automatically selected. However, if you create a new role and try to log in as that role, you will likely receive the error\n$ psql -h localhost -p 5432 -U foo FATAL: database \"foo\" does not exist Thus you’ll have to specify the database you want to connect to as well:\n$ psql -h localhost -p 5432 -U foo -d postgres By the way: During a session you can always change the database you’re connected to with \\c , but you cannot be connected to no database at any moment.\nThe Password In a fresh installation, your OS user and the postgres role do not have a password set. This would usually mean that you cannot use that role to login with, but the standard Client Authentication Configuration, i.e. the pg_hba.conf file is configured to trust all connections from localhost or 127.0.0.1/32.\nActually assigning a password to a role won’t change anything, only if you change the line in the pg_hba.conf too will you be asked to provide a password when logging in:\n# TYPE DATABASE USER ADDRESS METHOD # IPv4 local connections: host all all 127.0.0.1/32 md5 # IPv6 local connections: host all all ::1/128 md5  Tip: Starting with PostgreSQL 10, you can also use scram-sha-256 for password hashing.\n Since you don’t want to pass the password as a command line parameter, since it is then leaked into the history-file, you can add an entry to a .pgpass file in your $HOME:\n# hostname:port:database:username:password localhost:5432:*:postgres:mySuperSecretPassword Now everytime you connect to a PostgreSQL instance on localhost port 5432 and any database using the postgres role, the password is filled in automatically.\nThe Port Since you can run multiple PostgreSQL instances on the same machine but all are reached via localhost, you need to provide different ports for every instance. If oyu only have one instance, the standard port is 5432.\nSumming up So in essence, the command\n$ psql -h localhost does the same as\n$ psql -h localhost -p 5432 -U  -d  Password for user postgres: ... Looking around While you can execute any SQL statement you want using the psql tool, there are a few shortcuts that make your life easier (if you can remember them). To list them all, write \\? or have a look at this cheat sheet:\nDatabases  Tip: If you don’t have a database to play with, try out this example dump!\n I like to start listing all databases in the current instance, using\njannikarndt@[local]:jannikarndt=# \\l+ List of databases ┌─────────────┬─────────────┬─────┬─────────┬────────────┬──────────────┐ │ Name │ Owner │ ... │ Size │ Tablespace │ Description │ ├─────────────┼─────────────┼─────┼─────────┼────────────┼──────────────┤ │ jannikarndt │ jannikarndt │ ... │ 7709 kB │ pg_default │ ... │ │ mywebshop │ jannikarndt │ ... │ 14 MB │ pg_default │ ... │ │ postgres │ postgres │ ... │ 8005 kB │ pg_default │ ... │ │ template0 │ postgres │ ... │ 7577 kB │ pg_default │ ... │ │ template1 │ postgres │ ... │ 7577 kB │ pg_default │ ... │ └─────────────┴─────────────┴─────┴─────────┴────────────┴──────────────┘ (5 rows) (slightly abbreviated by the columns Encoding, Collate, Ctype, Access privileges and Tablespace)\nAs you see, one of the databases is larger then the others. That might be an interesting one.\nTo list tables in that database, we first have to connect to it:\njannikarndt@[local]:jannikarndt=# \\dn+ List of schemas ┌────────┬──────────┬──────────────────────┬────────────────────────┐ │ Name │ Owner │ Access privileges │ Description │ ├────────┼──────────┼──────────────────────┼────────────────────────┤ │ public │ postgres │ postgres=UC/postgres↵│ standard public schema │ │ │ │ =UC/postgres │ │ └────────┴──────────┴──────────────────────┴────────────────────────┘ (1 row) jannikarndt@[local]:jannikarndt=# \\c mywebshop You are now connected to database \"mywebshop\" as user \"jannikarndt\". jannikarndt@[local]:mywebshop=# \\dn+ List of schemas ┌─────────┬──────────┬──────────────────────┬────────────────────────┐ │ Name │ Owner │ Access privileges │ Description │ ├─────────┼──────────┼──────────────────────┼────────────────────────┤ │ public │ postgres │ postgres=UC/postgres↵│ standard public schema │ │ │ │ =UC/postgres │ │ │ webshop │ postgres │ │ │ └─────────┴──────────┴──────────────────────┴────────────────────────┘ (2 rows) Note that the first and the second entry for public are different schemas! The first is jannikarndt.public, the second is mywebshop.public.\nTables Next, let’s list all tables in the webshop schema. Running \\dt+ unfortunately will either result in\njannikarndt@[local]:mywebshop=# \\dt+ Did not find any relations. or showing tables that have nothing to do with the webshop schema:\njannikarndt@[local]:mywebshop=# \\dt+ List of relations ┌────────┬──────────────┬───────┬──────────┬─────────┬─────────────┐ │ Schema │ Name │ Type │ Owner │ Size │ Description │ ├────────┼──────────────┼───────┼──────────┼─────────┼─────────────┤ │ public │ public_table │ table │ postgres │ 0 bytes │ │ └────────┴──────────────┴───────┴──────────┴─────────┴─────────────┘ (1 row) This is because if you don’t enter a search path, psql will use your current search path, which points to the schema with your username and the public schema:\njannikarndt@[local]:mywebshop=# SHOW search_path mywebshop-# ; ┌─────────────────┐ │ search_path │ ├─────────────────┤ │ \"$user\", public │ └─────────────────┘ (1 row) To list the tables of the webshop schema, you have to either set the search path using SET search_path TO webshop; or make it explicit in the query:\njannikarndt@[local]:mywebshop=# \\dt+ webshop.* List of relations ┌─────────┬─────────────────┬───────┬──────────┬─────────┬────────────────────┐ │ Schema │ Name │ Type │ Owner │ Size │ Description │ ├─────────┼─────────────────┼───────┼──────────┼─────────┼────────────────────┤ │ webshop │ address │ table │ postgres │ 136 kB │ Addresses for r... │ │ webshop │ articles │ table │ postgres │ 2872 kB │ Instance of a p... │ │ webshop │ colors │ table │ postgres │ 48 kB │ Colors with nam... │ │ webshop │ customer │ table │ postgres │ 152 kB │ Basic customer ... │ │ webshop │ labels │ table │ postgres │ 112 kB │ Brands / labels... │ │ webshop │ order │ table │ postgres │ 176 kB │ Metadata for an... │ │ webshop │ order_positions │ table │ postgres │ 384 kB │ Articles that a... │ │ webshop │ products │ table │ postgres │ 112 kB │ Groups articles... │ │ webshop │ sizes │ table │ postgres │ 16 kB │ Colors with nam... │ │ webshop │ stock │ table │ postgres │ 928 kB │ Amount of artic... │ └─────────┴─────────────────┴───────┴──────────┴─────────┴────────────────────┘ (10 rows) Setting the search path allows you to query multiple schemas:\njannikarndt@[local]:mywebshop=# SET search_path TO webshop,public; SET jannikarndt@[local]:mywebshop=# \\dt List of relations ┌─────────┬─────────────────┬───────┬──────────┐ │ Schema │ Name │ Type │ Owner │ ├─────────┼─────────────────┼───────┼──────────┤ │ public │ public_table │ table │ postgres │ │ webshop │ address │ table │ postgres │ │ ... │ ... │ ... │ ... │ └─────────┴─────────────────┴───────┴──────────┘ (11 rows) To query all schemas, run \\dt+ *.*, but beware, this also lists the tables in information_schema and pg_catalog, so… a lot.\nViews Attention: \\dt only lists tables, not views. Those need to be queried seperately:\njannikarndt@[local]:mywebshop=# \\dv+ webshop.* List of relations ┌─────────┬──────────────────────────┬──────┬──────────┬─────────┬─────────────┐ │ Schema │ Name │ Type │ Owner │ Size │ Description │ ├─────────┼──────────────────────────┼──────┼──────────┼─────────┼─────────────┤ │ webshop │ most_ordered_products │ view │ postgres │ 0 bytes │ │ │ webshop │ numbers_sold_per_article │ view │ postgres │ 0 bytes │ │ │ webshop │ numbers_sold_per_product │ view │ postgres │ 0 bytes │ │ └─────────┴──────────────────────────┴──────┴──────────┴─────────┴─────────────┘ (3 rows) Detailed Information Next, you can get all information on a single table with \\d+ .:\njannikarndt@[local]:mywebshop=# \\d webshop.order Table \"webshop.order\" ┌───────────────────┬────────────────┬──────┬──────────┬─────────────────┐ │ Column │ Type │ Coll │ Nullable │ Default │ ├───────────────────┼────────────────┼──────┼──────────┼─────────────────┤ │ id │ integer │ │ not null │ nextval(ord... │ │ customerid │ integer │ │ │ │ │ ordertimestamp │ timestamp w... │ │ │ now() │ │ shippingaddressid │ integer │ │ │ │ │ total │ money │ │ │ │ │ shippingcost │ money │ │ │ │ │ created │ timestamp w... │ │ │ now() │ │ updated │ timestamp w... │ │ │ │ └───────────────────┴────────────────┴──────┴──────────┴─────────────────┘ Indexes: \"order_pkey\" PRIMARY KEY, btree (id) Foreign-key constraints: \"fk_order_to_customer\" FOREIGN KEY (customerid) REFERENCES customer(id) \"order_shippingaddressid_fkey\" FOREIGN KEY (shippingaddressid) REFERENCES address(id) Referenced by: TABLE \"order_positions\" CONSTRAINT \"order_positions_orderid_fkey\" FOREIGN KEY (orderid) REFERENCES \"order\"(id) Or for views:\njannikarndt@[local]:mywebshop=# \\d+ webshop.most_ordered_products View \"webshop.most_ordered_products\" ┌──────────────────────┬─────────┬───────────┬──────────┬─────────┬──────────┬──────┐ │ Column │ Type │ Collation │ Nullable │ Default │ Storage │ Desc │ ├──────────────────────┼─────────┼───────────┼──────────┼─────────┼──────────┼──────┤ │ id │ integer │ │ │ │ plain │ │ │ label │ text │ │ │ │ extended │ │ │ product │ text │ │ │ │ extended │ │ │ number_products_sold │ numeric │ │ │ │ main │ │ └──────────────────────┴─────────┴───────────┴──────────┴─────────┴──────────┴──────┘ View definition: SELECT products.id, labels.name AS label, products.name AS product, numbers_sold_per_product.number_products_sold FROM products products JOIN labels ON products.labelid = labels.id JOIN numbers_sold_per_product ON products.id = numbers_sold_per_product.productid ORDER BY numbers_sold_per_product.number_products_sold DESC LIMIT 20; Note that appending the + gives you the CREATE-statement for the view.\nUsers / Roles Finally, we should also have a look at the users:\njannikarndt@[local]:jannikarndt=# \\du+ List of roles ┌──────────────┬────────────────────────────────────┬────────────────┬─────────────┐ │ Role name │ Attributes │ Member of │ Description │ ├──────────────┼────────────────────────────────────┼────────────────┼─────────────┤ │ analytics │ │ {readonly} │ │ │ jannikarndt │ Superuser, Create role, Create DB │ {} │ │ │ mobile_app │ │ {write_access} │ │ │ postgres │ Superuser, Create role, Create DB, │ │ │ │ │ Replication, Bypass RLS │ │ │ │ readonly │ Cannot login │ {} │ │ │ web_app │ │ {write_access} │ │ │ write_access │ Cannot login │ {} │ │ └──────────────┴────────────────────────────────────┴────────────────┴─────────────┘ Officially, PostgreSQL doesn’t have users, only roles. The command however still uses the u.\nYou can see here, that there are two roles that cannot login (readonly and write_access). These are typically used to defined permissions. The roles that can login (analytics, web_app and mobile_app) are member of one of these roles so the admin doesn’t have to care about setting permissions for each of them.\nRecap To sum it up, these are the most important commands:\n\\l+-- list databases \\c-- connect to a database \\dn+-- list schemas \\dt+schema.*-- list tables \\dv+schema.*-- list views \\d+schema.relname-- describe table or view \\du+-- list users / roles ",
  "wordCount" : "1801",
  "inLanguage": "en",
  "datePublished": "2018-08-16T15:00:00+01:00",
  "dateModified": "2018-08-16T15:00:00+01:00",
  "author":{
    "@type": "Person",
    "name": "Jannik Arndt"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://www.jannikarndt.de/blog/2018/08/postgresql_with_psql_pgcli/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jannik Arndt",
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.jannikarndt.de/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://www.jannikarndt.de/" accesskey="h" title="JannikArndt.de (Alt + H)">
                <img src="/favicons/apple-touch-icon.png" alt="logo" aria-label="logo"
                    height="35">JannikArndt.de</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://www.jannikarndt.de/about/" title="about">
                    <span>about</span>
                </a>
            </li>
            <li>
                <a href="https://www.jannikarndt.de/archive/" title="blog">
                    <span>blog</span>
                </a>
            </li>
            <li>
                <a href="https://www.jannikarndt.de/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://www.jannikarndt.de/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://www.jannikarndt.de/">Home</a>&nbsp;»&nbsp;<a href="https://www.jannikarndt.de/blog/">Blog</a></div>
    <h1 class="post-title">
      Examining a PostgreSQL with psql or pgcli
    </h1>
    <div class="post-meta"><span title='2018-08-16 15:00:00 +0100 +0100'>August 16, 2018</span>&nbsp;·&nbsp;Jannik Arndt

</div>
  </header> 
  <div class="post-content"><p>The PostgreSQL installation comes with a great tool, <code>psql</code>, to administer and inspect the database. <a href="https://www.pgcli.com"><code>pgcli</code></a> extends this with syntax highlighting and autocompletion.</p>
<h2 id="starting-and-connecting">Starting and Connecting<a hidden class="anchor" aria-hidden="true" href="#starting-and-connecting">#</a></h2>
<p><code>psql</code> comes with you local PostgreSQL installation, <code>pgcli</code> can be installed via <code>brew install pgcli</code> or <code>pip install pgcli</code>.</p>
<p>When you start the tool, you need to specify the connection. PostgreSQL can be accessed via <em>TCP/IP</em> or <em>Unix Sockets</em>. If you installed <a href="https://postgresapp.com/">Postgres.app</a>, TCP will be the standard and you only need to specify the host (<code>h</code>):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ psql -h localhost
</code></pre></div><p>This assumes three things:</p>
<ul>
<li>the user is your OS user</li>
<li>the database name is the same as the user</li>
<li>connections from localhost are automatically trusted</li>
<li>the port is 5432</li>
</ul>
<p>Let&rsquo;s go into details here:</p>
<h3 id="the-user">The User<a hidden class="anchor" aria-hidden="true" href="#the-user">#</a></h3>
<p>To be precise, PostgreSQL doesn&rsquo;t have users, it has roles. Roles you can login with are created as <code>ROLE WITH LOGIN</code>. A standard installation usually comes with a role for the OS account and a <code>postgres</code> role. To add more roles, you need to login first.</p>
<blockquote>
<p>Tip: Users can be listed with the <code>\du+</code> command!</p>
</blockquote>
<h3 id="the-database">The Database<a hidden class="anchor" aria-hidden="true" href="#the-database">#</a></h3>
<p>The OS user and the postgres role have a corresponding database, which is automatically selected. However, if you create a new role and try to log in as that role, you will likely receive the error</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ psql -h localhost -p <span class="m">5432</span> -U foo
FATAL:  database <span class="s2">&#34;foo&#34;</span> does not exist
</code></pre></div><p>Thus you&rsquo;ll have to specify the database you want to connect to as well:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ psql -h localhost -p <span class="m">5432</span> -U foo -d postgres
</code></pre></div><p>By the way: During a session you can always change the database you&rsquo;re connected to with <code>\c &lt;databasename&gt;</code>, but you cannot be connected to no database at any moment.</p>
<h3 id="the-password">The Password<a hidden class="anchor" aria-hidden="true" href="#the-password">#</a></h3>
<p>In a fresh installation, your OS user and the postgres role do not have a password set. This would usually mean that you cannot use that role to login with, <em>but</em> the standard <em>Client Authentication Configuration</em>, i.e. the <code>pg_hba.conf</code> file is configured to <code>trust</code> all connections from <code>localhost</code> or <code>127.0.0.1/32</code>.</p>
<p>Actually assigning a password to a role won&rsquo;t change anything, only if you change the line in the <code>pg_hba.conf</code> too will you be asked to provide a password when logging in:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="c1"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>
<span class="c1"># IPv4 local connections:</span>
<span class="na">host    all             all             127.0.0.1/32            md5</span>
<span class="c1"># IPv6 local connections:</span>
<span class="na">host    all             all             ::1/128                 md5</span>
</code></pre></div><blockquote>
<p>Tip: Starting with PostgreSQL 10, you can also use <code>scram-sha-256</code> for password hashing.</p>
</blockquote>
<p>Since you don&rsquo;t want to pass the password as a command line parameter, since it is then leaked into the history-file, you can add an entry to a <code>.pgpass</code> file in your $HOME:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="c1"># hostname:port:database:username:password</span>
<span class="na">localhost:5432:*:postgres:mySuperSecretPassword</span>
</code></pre></div><p>Now everytime you connect to a PostgreSQL instance on <code>localhost</code> port <code>5432</code> and <em>any</em> database using the <code>postgres</code> role, the password is filled in automatically.</p>
<h3 id="the-port">The Port<a hidden class="anchor" aria-hidden="true" href="#the-port">#</a></h3>
<p>Since you can run multiple PostgreSQL instances on the same machine but all are reached via <code>localhost</code>, you need to provide different ports for every instance. If oyu only have one instance, the standard port is <code>5432</code>.</p>
<h3 id="summing-up">Summing up<a hidden class="anchor" aria-hidden="true" href="#summing-up">#</a></h3>
<p>So in essence, the command</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ psql -h localhost
</code></pre></div><p>does the same as</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ psql -h localhost -p <span class="m">5432</span> -U &lt;os-user&gt; -d &lt;os-user&gt;
Password <span class="k">for</span> user postgres: ...
</code></pre></div><h2 id="looking-around">Looking around<a hidden class="anchor" aria-hidden="true" href="#looking-around">#</a></h2>
<p>While you can execute any SQL statement you want using the <code>psql</code> tool, there are a few shortcuts that make your life easier (if you can remember them). To list them all, write <code>\?</code> or have a look at <a href="http://gpdb.docs.pivotal.io/gs/43/pdf/PSQLQuickRef.pdf">this cheat sheet</a>:</p>
<h3 id="databases">Databases<a hidden class="anchor" aria-hidden="true" href="#databases">#</a></h3>
<blockquote>
<p>Tip: If you don&rsquo;t have a database to play with, try out <a href="https://github.com/JannikArndt/PostgreSQLSampleDatabase">this example dump</a>!</p>
</blockquote>
<p>I like to start listing all databases in the current instance, using</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:jannikarndt<span class="o">=</span><span class="c1"># \l+</span>

                          List of databases
┌─────────────┬─────────────┬─────┬─────────┬────────────┬──────────────┐
│    Name     │    Owner    │ ... │  Size   │ Tablespace │ Description  │
├─────────────┼─────────────┼─────┼─────────┼────────────┼──────────────┤
│ jannikarndt │ jannikarndt │ ... │ <span class="m">7709</span> kB │ pg_default │ ...          │
│ mywebshop   │ jannikarndt │ ... │ <span class="m">14</span> MB   │ pg_default │ ...          │
│ postgres    │ postgres    │ ... │ <span class="m">8005</span> kB │ pg_default │ ...          │
│ template0   │ postgres    │ ... │ <span class="m">7577</span> kB │ pg_default │ ...          │
│ template1   │ postgres    │ ... │ <span class="m">7577</span> kB │ pg_default │ ...          │
└─────────────┴─────────────┴─────┴─────────┴────────────┴──────────────┘
<span class="o">(</span><span class="m">5</span> rows<span class="o">)</span>
</code></pre></div><p><small>(slightly abbreviated by the columns <code>Encoding</code>, <code>Collate</code>, <code>Ctype</code>, <code>Access privileges</code> and <code>Tablespace</code>)</small></p>
<p>As you see, one of the databases is larger then the others. That might be an interesting one.</p>
<p>To list tables in that database, we first have to connect to it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:jannikarndt<span class="o">=</span><span class="c1"># \dn+</span>

                           List of schemas
┌────────┬──────────┬──────────────────────┬────────────────────────┐
│  Name  │  Owner   │  Access privileges   │      Description       │
├────────┼──────────┼──────────────────────┼────────────────────────┤
│ public │ postgres │ <span class="nv">postgres</span><span class="o">=</span>UC/postgres↵│ standard public schema │
│        │          │ <span class="o">=</span>UC/postgres         │                        │
└────────┴──────────┴──────────────────────┴────────────────────────┘
<span class="o">(</span><span class="m">1</span> row<span class="o">)</span>

jannikarndt@<span class="o">[</span>local<span class="o">]</span>:jannikarndt<span class="o">=</span><span class="c1"># \c mywebshop</span>
You are now connected to database <span class="s2">&#34;mywebshop&#34;</span> as user <span class="s2">&#34;jannikarndt&#34;</span>.

jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \dn+</span>

                           List of schemas
┌─────────┬──────────┬──────────────────────┬────────────────────────┐
│  Name   │  Owner   │  Access privileges   │      Description       │
├─────────┼──────────┼──────────────────────┼────────────────────────┤
│ public  │ postgres │ <span class="nv">postgres</span><span class="o">=</span>UC/postgres↵│ standard public schema │
│         │          │ <span class="o">=</span>UC/postgres         │                        │
│ webshop │ postgres │                      │                        │
└─────────┴──────────┴──────────────────────┴────────────────────────┘
<span class="o">(</span><span class="m">2</span> rows<span class="o">)</span>
</code></pre></div><p>Note that the first and the second entry for <code>public</code> are <em>different</em> schemas! The first is <code>jannikarndt.public</code>, the second is <code>mywebshop.public</code>.</p>
<h3 id="tables">Tables<a hidden class="anchor" aria-hidden="true" href="#tables">#</a></h3>
<p>Next, let&rsquo;s <strong>list all tables</strong> in the <code>webshop</code> schema. Running <code>\dt+</code> unfortunately will either result in</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \dt+</span>
Did not find any relations.
</code></pre></div><p>or showing tables that have nothing to do with the <code>webshop</code> schema:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \dt+</span>

                         List of relations
┌────────┬──────────────┬───────┬──────────┬─────────┬─────────────┐
│ Schema │     Name     │ Type  │  Owner   │  Size   │ Description │
├────────┼──────────────┼───────┼──────────┼─────────┼─────────────┤
│ public │ public_table │ table │ postgres │ <span class="m">0</span> bytes │             │
└────────┴──────────────┴───────┴──────────┴─────────┴─────────────┘
<span class="o">(</span><span class="m">1</span> row<span class="o">)</span>
</code></pre></div><p>This is because if you don&rsquo;t enter a <em>search path</em>, <code>psql</code> will use your <em>current</em> search path, which points to the schema with your username and the public schema:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># SHOW search_path</span>
mywebshop-# <span class="p">;</span>
┌─────────────────┐
│   search_path   │
├─────────────────┤
│ <span class="s2">&#34;</span><span class="nv">$user</span><span class="s2">&#34;</span>, public │
└─────────────────┘
<span class="o">(</span><span class="m">1</span> row<span class="o">)</span>
</code></pre></div><p>To list the tables of the <code>webshop</code> schema, you have to either <strong>set the search path</strong> using <code>SET search_path TO webshop;</code> or <strong>make it explicit in the query</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \dt+ webshop.*</span>

                         List of relations
┌─────────┬─────────────────┬───────┬──────────┬─────────┬────────────────────┐
│ Schema  │      Name       │ Type  │  Owner   │  Size   │    Description     │
├─────────┼─────────────────┼───────┼──────────┼─────────┼────────────────────┤
│ webshop │ address         │ table │ postgres │ <span class="m">136</span> kB  │ Addresses <span class="k">for</span> r... │
│ webshop │ articles        │ table │ postgres │ <span class="m">2872</span> kB │ Instance of a p... │
│ webshop │ colors          │ table │ postgres │ <span class="m">48</span> kB   │ Colors with nam... │
│ webshop │ customer        │ table │ postgres │ <span class="m">152</span> kB  │ Basic customer ... │
│ webshop │ labels          │ table │ postgres │ <span class="m">112</span> kB  │ Brands / labels... │
│ webshop │ order           │ table │ postgres │ <span class="m">176</span> kB  │ Metadata <span class="k">for</span> an... │
│ webshop │ order_positions │ table │ postgres │ <span class="m">384</span> kB  │ Articles that a... │
│ webshop │ products        │ table │ postgres │ <span class="m">112</span> kB  │ Groups articles... │
│ webshop │ sizes           │ table │ postgres │ <span class="m">16</span> kB   │ Colors with nam... │
│ webshop │ stock           │ table │ postgres │ <span class="m">928</span> kB  │ Amount of artic... │
└─────────┴─────────────────┴───────┴──────────┴─────────┴────────────────────┘
<span class="o">(</span><span class="m">10</span> rows<span class="o">)</span>
</code></pre></div><p>Setting the search path allows you to <strong>query multiple schemas</strong>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># SET search_path TO webshop,public;</span>
SET
jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \dt</span>

               List of relations
┌─────────┬─────────────────┬───────┬──────────┐
│ Schema  │      Name       │ Type  │  Owner   │
├─────────┼─────────────────┼───────┼──────────┤
│ public  │ public_table    │ table │ postgres │
│ webshop │ address         │ table │ postgres │
│ ...     │ ...             │ ...   │ ...      │
└─────────┴─────────────────┴───────┴──────────┘
<span class="o">(</span><span class="m">11</span> rows<span class="o">)</span>
</code></pre></div><p>To query <em>all</em> schemas, run <code>\dt+ *.*</code>, but beware, this also lists the tables in <code>information_schema</code> and <code>pg_catalog</code>, so… a lot.</p>
<h3 id="views">Views<a hidden class="anchor" aria-hidden="true" href="#views">#</a></h3>
<p>Attention: <code>\dt</code> only lists <em>tables</em>, not views. Those need to be queried seperately:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \dv+ webshop.*</span>

                               List of relations
┌─────────┬──────────────────────────┬──────┬──────────┬─────────┬─────────────┐
│ Schema  │           Name           │ Type │  Owner   │  Size   │ Description │
├─────────┼──────────────────────────┼──────┼──────────┼─────────┼─────────────┤
│ webshop │ most_ordered_products    │ view │ postgres │ <span class="m">0</span> bytes │             │
│ webshop │ numbers_sold_per_article │ view │ postgres │ <span class="m">0</span> bytes │             │
│ webshop │ numbers_sold_per_product │ view │ postgres │ <span class="m">0</span> bytes │             │
└─────────┴──────────────────────────┴──────┴──────────┴─────────┴─────────────┘
<span class="o">(</span><span class="m">3</span> rows<span class="o">)</span>
</code></pre></div><h3 id="detailed-information">Detailed Information<a hidden class="anchor" aria-hidden="true" href="#detailed-information">#</a></h3>
<p>Next, you can get all information on a single table with <code>\d+ &lt;schema&gt;.&lt;tablename&gt;</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \d webshop.order</span>

                        Table <span class="s2">&#34;webshop.order&#34;</span>
┌───────────────────┬────────────────┬──────┬──────────┬─────────────────┐
│      Column       │     Type       │ Coll │ Nullable │    Default      │
├───────────────────┼────────────────┼──────┼──────────┼─────────────────┤
│ id                │ integer        │      │ not null │ nextval<span class="o">(</span>ord...  │
│ customerid        │ integer        │      │          │                 │
│ ordertimestamp    │ timestamp w... │      │          │ now<span class="o">()</span>           │
│ shippingaddressid │ integer        │      │          │                 │
│ total             │ money          │      │          │                 │
│ shippingcost      │ money          │      │          │                 │
│ created           │ timestamp w... │      │          │ now<span class="o">()</span>           │
│ updated           │ timestamp w... │      │          │                 │
└───────────────────┴────────────────┴──────┴──────────┴─────────────────┘
Indexes:
    <span class="s2">&#34;order_pkey&#34;</span> PRIMARY KEY, btree <span class="o">(</span>id<span class="o">)</span>
Foreign-key constraints:
    <span class="s2">&#34;fk_order_to_customer&#34;</span> FOREIGN KEY <span class="o">(</span>customerid<span class="o">)</span> REFERENCES customer<span class="o">(</span>id<span class="o">)</span>
    <span class="s2">&#34;order_shippingaddressid_fkey&#34;</span> FOREIGN KEY <span class="o">(</span>shippingaddressid<span class="o">)</span> REFERENCES address<span class="o">(</span>id<span class="o">)</span>
Referenced by:
    TABLE <span class="s2">&#34;order_positions&#34;</span> CONSTRAINT <span class="s2">&#34;order_positions_orderid_fkey&#34;</span> 
    FOREIGN KEY <span class="o">(</span>orderid<span class="o">)</span> REFERENCES <span class="s2">&#34;order&#34;</span><span class="o">(</span>id<span class="o">)</span>
</code></pre></div><p>Or for views:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:mywebshop<span class="o">=</span><span class="c1"># \d+ webshop.most_ordered_products</span>

                          View <span class="s2">&#34;webshop.most_ordered_products&#34;</span>
┌──────────────────────┬─────────┬───────────┬──────────┬─────────┬──────────┬──────┐
│        Column        │  Type   │ Collation │ Nullable │ Default │ Storage  │ Desc │
├──────────────────────┼─────────┼───────────┼──────────┼─────────┼──────────┼──────┤
│ id                   │ integer │           │          │         │ plain    │      │
│ label                │ text    │           │          │         │ extended │      │
│ product              │ text    │           │          │         │ extended │      │
│ number_products_sold │ numeric │           │          │         │ main     │      │
└──────────────────────┴─────────┴───────────┴──────────┴─────────┴──────────┴──────┘
View definition:
 SELECT products.id,
    labels.name AS label,
    products.name AS product,
    numbers_sold_per_product.number_products_sold
   FROM products products
     JOIN labels ON products.labelid <span class="o">=</span> labels.id
     JOIN numbers_sold_per_product ON products.id <span class="o">=</span> numbers_sold_per_product.productid
  ORDER BY numbers_sold_per_product.number_products_sold DESC
 LIMIT 20<span class="p">;</span>
</code></pre></div><p>Note that appending the <code>+</code> gives you the <code>CREATE</code>-statement for the view.</p>
<h3 id="users--roles">Users / Roles<a hidden class="anchor" aria-hidden="true" href="#users--roles">#</a></h3>
<p>Finally, we should also have a look at the users:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">jannikarndt@<span class="o">[</span>local<span class="o">]</span>:jannikarndt<span class="o">=</span><span class="c1"># \du+</span>

                                List of roles
┌──────────────┬────────────────────────────────────┬────────────────┬─────────────┐
│  Role name   │       Attributes                   │   Member of    │ Description │
├──────────────┼────────────────────────────────────┼────────────────┼─────────────┤
│ analytics    │                                    │ <span class="o">{</span>readonly<span class="o">}</span>     │             │
│ jannikarndt  │ Superuser, Create role, Create DB  │ <span class="o">{}</span>             │             │
│ mobile_app   │                                    │ <span class="o">{</span>write_access<span class="o">}</span> │             │
│ postgres     │ Superuser, Create role, Create DB, │                │             │
│              │ Replication, Bypass RLS            │                │             │
│ <span class="nb">readonly</span>     │ Cannot login                       │ <span class="o">{}</span>             │             │
│ web_app      │                                    │ <span class="o">{</span>write_access<span class="o">}</span> │             │
│ write_access │ Cannot login                       │ <span class="o">{}</span>             │             │
└──────────────┴────────────────────────────────────┴────────────────┴─────────────┘
</code></pre></div><p>Officially, PostgreSQL doesn&rsquo;t have users, only roles. The command however still uses the <code>u</code>.</p>
<p>You can see here, that there are two roles that cannot login (<code>readonly</code> and <code>write_access</code>). These are typically used to defined permissions. The roles that <em>can</em> login (<code>analytics</code>, <code>web_app</code> and <code>mobile_app</code>) are member of one of these roles so the admin doesn&rsquo;t have to care about setting permissions for each of them.</p>
<h3 id="recap">Recap<a hidden class="anchor" aria-hidden="true" href="#recap">#</a></h3>
<p>To sum it up, these are the most important commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="err">\</span><span class="n">l</span><span class="o">+</span><span class="w">                     </span><span class="c1">-- list databases
</span><span class="c1"></span><span class="err">\</span><span class="k">c</span><span class="w">                      </span><span class="c1">-- connect to a database
</span><span class="c1"></span><span class="err">\</span><span class="n">dn</span><span class="o">+</span><span class="w">                    </span><span class="c1">-- list schemas
</span><span class="c1"></span><span class="err">\</span><span class="n">dt</span><span class="o">+</span><span class="w"> </span><span class="o">&lt;</span><span class="k">schema</span><span class="o">&gt;</span><span class="p">.</span><span class="o">*</span><span class="w">         </span><span class="c1">-- list tables
</span><span class="c1"></span><span class="err">\</span><span class="n">dv</span><span class="o">+</span><span class="w"> </span><span class="o">&lt;</span><span class="k">schema</span><span class="o">&gt;</span><span class="p">.</span><span class="o">*</span><span class="w">         </span><span class="c1">-- list views
</span><span class="c1"></span><span class="err">\</span><span class="n">d</span><span class="o">+</span><span class="w"> </span><span class="o">&lt;</span><span class="k">schema</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">relname</span><span class="o">&gt;</span><span class="w">  </span><span class="c1">-- describe table or view
</span><span class="c1"></span><span class="err">\</span><span class="n">du</span><span class="o">+</span><span class="w">                    </span><span class="c1">-- list users / roles
</span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://www.jannikarndt.de/tags/postgresql/">PostgreSQL</a></li>
      <li><a href="https://www.jannikarndt.de/tags/programming/">Programming</a></li>
    </ul>
  </footer>
</article>
    </main>
    

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
